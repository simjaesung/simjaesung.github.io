{"componentChunkName":"component---src-templates-blog-post-tsx","path":"/blog/online-state/","result":{"data":{"markdownRemark":{"html":"<h2>자료구조 선택과 고민</h2>\n<p>저희 12팀에서 백엔드를 담당하는 저를 비롯하여 영현님, 경수님과 함께 <strong>유저 온라인 상태 관리</strong>를 같이 구현하기로 하였습니다.</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 82.82208588957054%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACXElEQVR42q1UiZKiUAzk/z9udsYDLwQEReUGEfDA3nQUanZ2tmq3aqmKLyQh6XTyNMzJGFEYwrbXWC7n8H0Pm80G4/EI9/sd//oY1mKO8LDH2lphOh3D9zy4roPx6AO3202DHo8HXsrwPtiAX2KMKI7QNDX+12MspOU4CnG9XHCuTqjPZ9R1LXJ+ihRrmgaN2Nr6qdN/Op0GvReiNOo8xc61sZiZWK8WsJYLLIUGa7VUGsjxSnSHHM9nctqYTEbYbn2UpxJZliJLRbLsmbA6V7i0rcq963QQ5I7SiX69tLhdr4P9LnKV968cDi0TBR8m614Ju5fedZ/1p/QDYDHGskBfUBEmAt1fW5ibE1kXB5bolhRxHUfbdBwbc2mVk6fuit8RP2ngikXC//F4QJLEuEg3RiWDyPNMeaBeCdlFUaiUZal26nmeq482DiRNE7RC028tfzX8iZu/XpuPH29YyWTf399gTqcwzancmIXa2FK/xI9PSy2/L/kmITnMowh7uS28JZ630US8ilwNSng8Yiu23XaLINgpZ2F4VH2/DzSe/CqHNFqWpaRz4jyD3U65qqpK+aXEcazEp8Ip+YwERD8M8snhcNJGKYEx0bGKoDoEgTqZ7BkYaZJE4piIZ1nkyCRRLn4OiAUZy7UyCoF+JEqug8BmYqJki1wPW+xrKUQKBkq8Z/EsSYZryI40YSloUkERCBebjQtP/rpIgy8fepJ4L4iZxJVi9POdBV3ZWbas+2kTiK932yDpRDYzTeyCrbZVloW2RARnaZ33NBWdZ7+j1Htk/KYQGtq2wU9dCg1eVNrXfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img_1\" title=\"\" src=\"/static/50aa82f21f4622c6123a06ff87394cb0/a6d36/3.png\" srcset=\"/static/50aa82f21f4622c6123a06ff87394cb0/222b7/3.png 163w,\n/static/50aa82f21f4622c6123a06ff87394cb0/ff46a/3.png 325w,\n/static/50aa82f21f4622c6123a06ff87394cb0/a6d36/3.png 650w,\n/static/50aa82f21f4622c6123a06ff87394cb0/e548f/3.png 975w,\n/static/50aa82f21f4622c6123a06ff87394cb0/3c492/3.png 1300w,\n/static/50aa82f21f4622c6123a06ff87394cb0/874d1/3.png 1310w\" sizes=\"(max-width: 650px) 100vw, 650px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 103.68098159509202%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAADJklEQVR42qVViW7bOBT0/39f08S3rFvWRVKnZTvTGcoptgu0xWINTB7xKD4O3zHZjOOIKIoQxxGyLEUQnJEkMU6nI8qyxH/9baZ5QnZhkPCCw/GAj493bLcf2BFRGMJZi7qu0DQ1OudgraHPeOvXzqJtGr/nA+pPW16RXALkaYoizxGcT0jJ8rjbYvf+HWeyPRz22PKykN+d9zvseeGJvjOx375zvUPbtmvAJE3w9vYNlyAgs63/SMHKIkfTNqjIsOtWdq3YVqVnZcm+qioYYzyGYcDmkwE75qpk0IC3K5dxHPu8FkWB+lr4w7pUOW64FhOlQMG0rnje0KoenqEzrX9ikWdI49A/Pec6Yl4TXpDygpz7MfeC4MS91DOemf9pmnygmXZZFmwejzsd2hww9bTEsky4L7PHcp887vQ9lhvtDcuN/hv984jbjVgIruXfPJ8PZGmIy+WAikzKtxO6hnmyMVqbobsyR0mOjs+rTIi6XVG2AYzL4a4lXFrAmsKf2dzvC0veEg2G3qAzDVNQM+ElUcG1NZyKQmvslWC+jHB97RMk0Hcti2LWgNYyYGcZ1PrcjKzWT4z9P7D6Jtnx133FeT6f2PR9j3f2miZDzaye+z+/jRJZXdlvbG49fRzcmuwX5mn4LbTfOcMOCVmHiHlsWOXnHW2WoTlGqDglZV1y1JQj9VvN57k/YhwsR7HxGIdubRtVsGO1bEGWnebTeNsT09j9FfPUv+ygtiHDMEW9v3i4lK1QslV44zz9++B6+Mv/tV5tvwYUQzXzyOr2qjKnxvKpA+n3rLww9ILza8eOEJS7L2va+pX/bh09w4KkHLEkSTh2Cfa7D45c7FXnTEgjJWWa77quvSiovSRrWks3ZdUxPqClehSaVSJngeIo9CKhWY6i0EPCoEskbwpQUImkMFKgioQUXHPtAzZUlEIHyC4kmzOFNolXFY+lQIQEOCLbE/eOR8obrb6NKHktCd1unPPHg0X5/MRAh2WrZFQYqYwCiYHYSIX0L0GpSMlUilTx+/LFauAzf2nsTwac3VoQaZs+8pLOHEnzPKR/PnfGj9efJuUHgo47j+X2nO0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img_1\" title=\"\" src=\"/static/9dcd23ac36aa49b5a603e97676955f04/a6d36/4.png\" srcset=\"/static/9dcd23ac36aa49b5a603e97676955f04/222b7/4.png 163w,\n/static/9dcd23ac36aa49b5a603e97676955f04/ff46a/4.png 325w,\n/static/9dcd23ac36aa49b5a603e97676955f04/a6d36/4.png 650w,\n/static/9dcd23ac36aa49b5a603e97676955f04/e548f/4.png 975w,\n/static/9dcd23ac36aa49b5a603e97676955f04/3c492/4.png 1300w,\n/static/9dcd23ac36aa49b5a603e97676955f04/b1584/4.png 1342w\" sizes=\"(max-width: 650px) 100vw, 650px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>긴 시간동안 여러 자료구조에 대한 고민을 통해,</p>\n<p><strong>우선 1차로는 <code>Bitmap</code> + <code>Hash</code> 구조를 통해 접속된 유저에 대한 정보를 저장하자고 정했습니다.</strong></p>\n<br/>\n<p>각 자료구조의 역할은 아래와 같습니다.</p>\n<ol>\n<li>비트맵 (Bitmap)</li>\n</ol>\n<ul>\n<li>역할: 각 유저의 상태(로비/게임방/오프라인)를 최소한의 메모리로 효율적으로 기록</li>\n<li>구조: 두 개의 비트맵을 사용하여 로비와 게임방 상태를 각각 기록</li>\n</ul>\n<ol start=\"2\">\n<li>해시 (Hash)</li>\n</ol>\n<ul>\n<li>역할: 유저의 상세 정보(닉네임, ID 등)를 빠르게 조회</li>\n<li>구조: <code>user_id</code>를 키로 사용하고, 관련 유저 정보를 값으로 저장</li>\n</ul>\n<br/>\n<p><strong>Bitmap을 사용하는 이유는 아래와 같습니다.</strong></p>\n<ul>\n<li>메모리 효율성: 비트를 사용하여 최소한의 메모리로 다수의 유저 상태를 관리할 수 있습니다.</li>\n<li>빠른 연산: 비트 연산을 통해 유저의 상태를 신속하게 판별할 수 있습니다.</li>\n<li>비트맵 사용 사례\n<ul>\n<li><code>A = 로비</code>, <code>B = 게임방</code>일 때:\n<ul>\n<li><code>A &#x26;&#x26; B === 1</code>: 게임방에 있음.</li>\n<li><code>(A || B === 1) &#x26;&#x26; (A &#x26;&#x26; !B === 1)</code>: 로비에 있음.</li>\n<li><code>(A || B === 0)</code>: 오프라인.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>하지만 제가 판단하기에는 2개의 구조로 이를 관리한다면 새로운 유저가 입장할 때는 무엇을 전해줄 것인가? 였습니다.</p>\n<p>기존에 있던 유저에게는 상태가 변한 유저에대한 정보를 주고 이것만 업데이트하면되지만, 새로 들어온 유저에게는 현재 방 상태에 대한 정보를 다시 수집하고 줘야하기에 현재 온라인인 유저에 대해 순차탐색 + 비트연산이 필수라는 생각이 들었기 때문입니다.</p>\n<p><strong>그래서 저는 현재 온라인 상태인 유저들을 보관하는 자료구조가 하나 더 필요하다는 생각이 들었습니다.</strong></p>\n<p>하지만 너무 과하게 자료구조를 사용하는게 아닌가? 라는 딜레마에 빠졌습니다.</p>\n<p>그래도 현재 마음이 이 3개의 구조를 혼합하는 거에 끌리기에 한번 도전해보기로 했습니다.</p>\n<br/>\n<h2>1차 기획에 대한 구조</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61.34969325153374%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR42o1Sa4+CQAzc///TTPziWz/oKfIQQUQQlNdcp3drCN4lNim7y7bT6XQNrHWdetu2WK1WWCwWKIpCr/ivaZrX2t9z7e9NVVUoy1KwOk1+PB6o6lrPl8sFrusiz3NkWabOeP4/nU56vt1uSNNUMe73O8z1egU9kYA8DOF/fSGNIhQS7B6POBwOCHwf4fmMUO5Z0PM8jEYjTCYTzGYzTKdTBX8+nzD8ELkRVq14GgQokwS1sHK2W+x3O+yliOM46ixOduPxGPP5HMvlEuv1WjFYzPzI172k5EUtwLRYWLkCGsUxQgFh+9SK2pKIze3LZTCw4pctQzy2vNkgEcaZaBULMJ0sI5GFe648n6U41zdAikuGFF+TxAORgXtftKRW7ILJHA6dQ7GzeAPk6AnKtjhdDoVuGTGZk7XAdMbq6xAShgB9DYdsyYBJQ63/M32HFHgYzDMHYBlZ9nYIQ38Bsnr/YfeNhcjQvrFPTBmyf1b/C5AMWZRxnwB+AxJcoXfKBx9dAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img_1\" title=\"\" src=\"/static/1451456731662b33605672f862fd40f5/a6d36/1.png\" srcset=\"/static/1451456731662b33605672f862fd40f5/222b7/1.png 163w,\n/static/1451456731662b33605672f862fd40f5/ff46a/1.png 325w,\n/static/1451456731662b33605672f862fd40f5/a6d36/1.png 650w,\n/static/1451456731662b33605672f862fd40f5/e548f/1.png 975w,\n/static/1451456731662b33605672f862fd40f5/3c492/1.png 1300w,\n/static/1451456731662b33605672f862fd40f5/c68a4/1.png 2402w\" sizes=\"(max-width: 650px) 100vw, 650px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>대략적인 구조는 위와 같습니다.</p>\n<p>2개의 <strong><code>Bitmap</code></strong>, 2개의 <code>Hash</code>로 구성되어있는 다소 복잡한 구조입니다.</p>\n<p><strong>1. lobby 존재 여부 판단을 위한 <code>Bitmap</code> &#x26; room 입장 여부 판단을 위한 <code>Bitmap</code></strong></p>\n<p><code>Bitmap</code>을 2개 둔 이유는 유저가 현재 위치한 곳을 적은 메모리인 비트를 기반으로 비트 연산을 통해 쉽게 판별하기 위함입니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"tsx\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(lobby) , </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(room) 일 때</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> : 게임 방에 위치</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">||</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">!</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) : 로비에 위치</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">||</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">0</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">0</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) : 오프라인</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">||</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> (</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">!</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">A</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">&amp;&amp;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">B</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">===</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) : 로비에는 없지만, 룸에는 있는 </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-5\">상황</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> : 오류</span></span></span></code></pre>\n<br/>\n<p><strong>2. user의 정보를 빠르게 조회하기 위한 Redis 내부의 <code>Hash</code></strong></p>\n<p>저희 DB에 있는 user 테이블을 그대로 옮겨놓기 위한 Hash 자료구조입니다.</p>\n<p>현재 접속한 유저에 대한 정보를 Redis 내부에 관리하면서 빠르게 접근하여 관리하기 위함입니다.</p>\n<p>현재 user는 <code>user_id</code> 를 고유하게 갖는데, 이를 key값으로 user의 정보를 저장하지않을까 싶습니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"sql\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">CREATE</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">TABLE</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> user(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">user_id</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">bigint</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> auto_increment </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">primary</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">key</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    email </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">varchar</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">30</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">not</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    nickname </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">varchar</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">50</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">not</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">password</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">varchar</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">255</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    oauth_id </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">varchar</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">100</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">not</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    score </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">int</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">not</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    created_at </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">datetime</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">not</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">null</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span></code></pre>\n<p>더불어 <code>user_id</code> 를 BitMap의 Index로도 활용할 예정입니다.</p>\n<br/>\n<p><strong>3. 전체 online user 목록을 관리하기 위한 <code>Hash</code></strong></p>\n<p>말그대로 online user를 관리하기 위한 자료구조입니다.</p>\n<p>앞서 언급했 듯, 이를 추가한 이유는 새로운 유저가 연결되었을 때 유저의 상태를 살펴볼 필요가 없이 바로 전달해줄 걸 만들어 놓기 위함입니다.</p>\n<br/>\n<h3>1차 기획에 상황에 대한 플로우</h3>\n<p><strong>1. 새로운 유저가 입장할 때</strong></p>\n<ol>\n<li><code>userInfo</code>에 유저 정보 업데이트</li>\n<li><code>inLobby</code> 비트맵에서 해당 유저의 비트를 설정</li>\n<li><code>onlineUser</code>에 유저 상태 추가</li>\n</ol>\n<p><strong>2. 유저가 방에 들어가면</strong></p>\n<ol>\n<li><code>inRoom</code> 비트맵에서 해당 유저의 비트를 설정</li>\n<li>비트맵 연산을 통해 유저의 위치 업데이트</li>\n<li>비트맵 연산을 통해 <code>onlineUser</code> 에 해당 유저의 상태 업데이트</li>\n</ol>\n<p><strong>3. 유저가 로비로 나가면</strong></p>\n<ol>\n<li><code>inRoom</code> 비트맵에서 해당 유저의 비트를 설정</li>\n<li>비트맵 연산을 통해 유저의 위치 업데이트</li>\n<li>비트맵 연산을 통해 <code>onlineUser</code> 에 해당 유저의 상태 업데이트</li>\n</ol>\n<hr>\n<br/>\n<h2><strong>구현을 하고나서 겪은 문제점</strong></h2>\n<h3>현재 구조의 문제점</h3>\n<p>1차 기획의 방식으로 구현을 하고나니 여러 문제점을 겪을 수 있었습니다.</p>\n<ul>\n<li><strong>복잡성 증가</strong>: 여러 자료구조를 사용하다 보니 시스템이 지나치게 복잡해졌습니다.</li>\n<li><strong>비효율성</strong>: 새로운 유저가 입장할 때 기존 유저들의 상태를 모두 조회해야 했습니다.</li>\n<li><strong>불필요한 자료구조</strong>: <code>userInfo</code>와 <code>Bitmap</code>을 실제로 활용하지 못했습니다.</li>\n<li><strong>성능 저하 우려</strong>: 비트 연산과 전체 유저 목록의 빈번한 조회로 인해 성능 문제가 발생할 수 있었습니다.</li>\n</ul>\n<p>저는 이 모든 점이 복잡하게 여러 자료구조를 사용해서 발생한 문제라는 생각이 들었고, 간단한 구조로 개선하기로 하였습니다.</p>\n<br/>\n<h3>개선된 설계: 단순화된 Hash 구조</h3>\n<p>현재는 특정 유저의 상태가 변경되면, 해당 이벤트에 구독한 클라이언트에게 전체 온라인 유저 상태를 조회하여 이를 발행하는 성능적으로 좋지 못한 면이 있습니다.</p>\n<p>이를 개선하여 처음 등록되는 유저에게는 전체 목록을 보내주고, 이후에는 변경되는 유저 목록만 보내도록 개선하기로 하였습니다.</p>\n<p>현재 FE에서 온라인 유저 목록은 zustand 전역 상태로 관리되어있습니다.</p>\n<p>해당 자료구조는 고유한 userId를 key로 유저의 상태를 저장하는 객체이기에, 상수시간의 업데이트 시간을 보장할 수 있습니다.</p>\n<p>이를 구현하기위해 1차 기획에서 했던 자료구조에서 많은 개선이 일어났습니다.</p>\n<ul>\n<li><code>userInfo</code>와 <code>Bitmap</code> 제거: 실제로 활용되지 않거나 비효율적인 자료구조를 삭제했습니다.</li>\n<li><code>onlineUser</code> Hash만 사용: 유저의 온라인 상태와 위치 정보를 관리하기 위해 단일한 자료구조로 통합했습니다.</li>\n</ul>\n<br/>\n<p><strong>Simple is best.</strong></p>\n<p>결론적으로, <code>onlineUser</code> Hash만 사용하기로 하였습니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"bash\" data-index=\"2\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\"># onlineUser 자료구조</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">{</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\tuserId </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">:</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> { </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&quot;nickname&quot;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">:string, </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&quot;isInLobby&quot;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">:boolean }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<br/>\n<h3>개선 후 요청의 흐름</h3>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 650px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.760736196319016%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhklEQVR42o1SwU7CQBDdD/ED/CmPHj36LdwMiXfuEk0MkSMxmkgigRAE2pK2tEAppdvynLew2iAaJ5m0uzP75s2bUYPBAJ7nYTqdGh8Oh4iiCLvdDv8xvgmCAGVZmrMioOM4BnQ2m2E0GiGO46+E7XaLbreLPM9/gGVZhkajgVqthna7bUio3ypbhixUr9fN197b2HK5NGCMdzodaK2hbMIpp7Gdfr8P3/e/Cx1iyWqFVquFXq9nzuxKHbLwF9P1em2qWxmslRKjFFWJlPztGVWSeU7TFEmSGF8JE4LyrpC8UrQr53PxEDqOkEsxayc1ZDU+JgjBFouF+W42G7AXLYBa9CvkXkseB2dlUu7tDd4vLxA8Pe7ZVZgWRWEmSZYEsw9pmjFpN5V7FmeeGcrb9RWa52fw7u+Q6AIfsjbj8dg4B8Lpuq6LyWSCubRZtTAMzcoxTjeAzy+veGg28Sq7lkk1CszFprMyRWd1suO3qjNjdBtjR8r3AzjCwq7F8YRPrdJxvPr/CR6GS8eBT1zGAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"img_1\" title=\"\" src=\"/static/c4ae4d1ab1892600835b786fb0cb3ebd/a6d36/5.png\" srcset=\"/static/c4ae4d1ab1892600835b786fb0cb3ebd/222b7/5.png 163w,\n/static/c4ae4d1ab1892600835b786fb0cb3ebd/ff46a/5.png 325w,\n/static/c4ae4d1ab1892600835b786fb0cb3ebd/a6d36/5.png 650w,\n/static/c4ae4d1ab1892600835b786fb0cb3ebd/e548f/5.png 975w,\n/static/c4ae4d1ab1892600835b786fb0cb3ebd/3c492/5.png 1300w,\n/static/c4ae4d1ab1892600835b786fb0cb3ebd/df438/5.png 1556w\" sizes=\"(max-width: 650px) 100vw, 650px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n<p>새로운 유저 입장 시 일어나는 데이터 흐름입니다.</p>\n<ol>\n<li><strong>유저 연결 요청</strong>\n<ul>\n<li>새로운 유저가 <code>EventGateway</code>에 연결 요청을 보냅니다.</li>\n</ul>\n</li>\n<li><strong>Redis를 통해 현재 유저 목록 요청</strong>\n<ul>\n<li><code>EventGateway</code>는 Redis를 통해 해당 유저 추가 요청을 합니다.</li>\n<li>이후 현재 온라인 상태인 모든 유저 목록을 요청하고 이를 새로운 유저에게 전달합니다.</li>\n</ul>\n</li>\n<li><strong>유저 상태 이벤트 구독</strong>\n<ul>\n<li>새로운 유저는 <code>EventManager</code>의 <code>USER_DATA_CHANGED</code> 이벤트에 구독하여 실시간으로 유저 상태 업데이트를 받을 수 있도록 설정됩니다.</li>\n</ul>\n</li>\n<li><strong>유저 상태 변경 알림</strong>\n<ul>\n<li>이미 <code>USER_DATA_CHANGED</code> 이벤트에 구독되어있는 기존 온라인 유저들은 해당 유저의 변경된 상태만 업데이트합니다.</li>\n</ul>\n</li>\n</ol>\n<br/>\n<h2>코드를 통한 구체적인 흐름 설명</h2>\n<h3>처음 유저의 소켓 연결 시</h3>\n<ol>\n<li>redis의 <code>onlineUser</code>에 해당 유저의 정보를 업데이트시킵니다.</li>\n<li>이후 <code>USER_DATA_CHANGED</code> 이벤트에 구독한 다른 유저들에게 새로운 유저의 추가 정보 사실을 알립니다.</li>\n<li>해당 유저에게 존재하는 모든 온라인 유저 목록을 보내줍니다.</li>\n<li>새로운 유저를 <code>USER_DATA_CHANGED</code> 이벤트에 구독시킵니다.</li>\n</ol>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"tsx\" data-index=\"3\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  async </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">handleConnection</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(socket: </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">Socket</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">...</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">생략</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">const</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> { </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">nickname</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">userId</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> } </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">await</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.findUserInfoUsecase.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">find</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(token);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">const</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">client</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">new</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-10 grvsc-t4tStz-1\">EventClient</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(socket, </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.eventManager);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    client.nickname </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> nickname;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    client.userId </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> userId;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\t\t</span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">//1번 내용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">await</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.connectUserUseCase.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">enter</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">({</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      userId: </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">String</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(userId),</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">      nickname: nickname,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\t\t</span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">//2번 내용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publishOnlineUserUpsertEvent</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">String</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(userId), nickname);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">// 3번 내용 : 유저 접속 시 현재 online userList를 전송</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">const</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">onLineUserList</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">await</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.connectUserUseCase.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">getOnLineUserList</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    client.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">emit</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;online-user-list&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, onLineUserList);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    client.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">subscribe</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(Event.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">ROOM_DATA_CHANGED</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-6 grvsc-t4tStz-2\">//4번 내용</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    client.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">subscribe</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(Event.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">USER_DATA_CHANGED</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.connectedClients.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">set</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(socket, client);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publishRoomDataChangedEvent</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  }</span></span></span></code></pre>\n<br/>\n<h3>온라인 유저 상태 변경</h3>\n<p>유저 상태 변경은 게임 방 입퇴장, 닉네임 변경을 말합니다.</p>\n<p>유저 상태 변경이 일어나면 하단 이벤트가 발행됩니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"tsx\" data-index=\"4\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">private </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publishOnlineUserUpsertEvent</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  userId: string,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  nickname: string,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  isInLobby </span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">=</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">true</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.eventManager.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publish</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(Event.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">USER_DATA_CHANGED</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    event: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;upsert-online-user&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    data: { userId, nickname, isInLobby },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<p>클라이언트로 전송되는 해당 데이터로 상수시간에 유저 추가 및 업데이트가 가능합니다.</p>\n<br/>\n<h3>유저의 소켓 연결 종료 시</h3>\n<p>유저의 연결이 종료되면 하단 이벤트가 발행됩니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"tsx\" data-index=\"5\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">private </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publishOnlineUserExitEvent</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(userId: string) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">this</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">.eventManager.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-5\">publish</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">(Event.</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-1\">USER_DATA_CHANGED</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    event: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;exit-online-user&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">    data: { userId },</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">  });</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<p>client측에서 <code>userId</code>를 key로 갖는 데이터를 상수시간에 삭제하여 상태유지가 가능합니다.</p>\n<br/>\n<h2><strong>느낀 점</strong></h2>\n<p><strong>“ Simple is best”</strong> 라는 말은 괜히있는 말이 아닌 것 같습니다.</p>\n<p>이번 구현 과정에서 불필요하게 복잡한 자료구조는 유지보수와 성능 면에서 오히려 독이 될 수 있다는 점을 배웠습니다.</p>\n<p>복잡하지 않고 단순한 설계는 다른 사람을 설득하는 측면 그리고 스스로 구현하는 측면에서도 많은 장점을 가져온다는 것을 몸소 느낄 수 있었습니다.</p>\n<hr>\n<h3>1. 초기 온라인 유저 리스트 수신</h3>\n<p>처음 소켓 연결 시, 해당 유저가 받을 전체 온라인 유저 목록입니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"sql\" data-index=\"6\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">event</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">-</span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">name</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;online-user-list&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">data</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\t</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> : {nickname: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;재성&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, isInLobby: true},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\t</span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">2</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\"> : {nickname: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;현진&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">, isInLobby: true},</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\t...</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<br/>\n<h3>2. 유저 로비 입장 or 온라인 유저 상태 변경</h3>\n<ol>\n<li>새로운 유저의 소켓이 연결될 시, 원래 존재했던 인원들에게 <strong>broadcast</strong>되는 데이터입니다.</li>\n<li>게임 방 입/퇴장, 닉네임 변경 등 한 유저의 상태 변경 시 <strong>broadcast</strong>되는 데이터입니다.</li>\n</ol>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"sql\" data-index=\"7\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">event</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">-</span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">name</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;upsert-online-user&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">data</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\tuserId : </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\tnickname : </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;호눅스&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\tisInLobby : true,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<p><code>userId</code>를 key로 하여 그대로 업데이트 시켜주시면 될 것 같습니다.</p>\n<br/>\n<h3>3. 유저 로그아웃 및 창 닫기(소켓 연결 해제)</h3>\n<p>소켓의 연결이 끊긴 유저의 <code>userId</code> 가 전송됩니다.</p>\n<pre class=\"grvsc-container github-light-theme grvsc-ps-t4tStz\" data-language=\"sql\" data-index=\"8\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">event</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-9\">-</span><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">name</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: </span><span class=\"grvsc-tiszgT-8 grvsc-t4tStz-10\">&#39;exit-online-user&#39;</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-5 grvsc-t4tStz-9\">data</span><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">: {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">\tuserId : </span><span class=\"grvsc-tiszgT-7 grvsc-t4tStz-3\">1</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"grvsc-tiszgT-1 grvsc-t4tStz-1\">}</span></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .github-light-theme {\n    background-color: #ffffff;\n    color: #000000;\n  }\n  .github-light-theme .grvsc-tiszgT-7 { color: #005CC5; }\n  .github-light-theme .grvsc-tiszgT-1 { color: #000000; }\n  .github-light-theme .grvsc-tiszgT-10 { color: #6F42C1; }\n  .github-light-theme .grvsc-tiszgT-5 { color: #D73A49; }\n  .github-light-theme .grvsc-tiszgT-6 { color: #6A737D; }\n  .github-light-theme .grvsc-tiszgT-8 { color: #032F62; }\n  .github-light-theme .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n  body[data-theme=dark] .grvsc-ps-t4tStz { color: #ffffff; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-5 { color: #BB97E7; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-1 { color: #FFFFFF; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-9 { color: #EB7E81; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-3 { color: #66B5F6; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-2 { color: #A19B8F; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-t4tStz-10 { color: #9DCDF5; }\n  body[data-theme=dark] .grvsc-ps-t4tStz .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(0, 0, 0, 0.05));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(0, 0, 0, 0.2));\n  }\n</style>","frontmatter":{"title":"Redis를 통한 유저 온라인 상태 관리 시스템 구현하기","desc":"","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACIElEQVR42qVTTYgSYRgeDfawxygE6dJRAk9LEB12TemQsu6hWOpQx37osjNKsusPO26dOmx7CoI6lYcNKtpW3TUVw6hZCXFUlrJN02mjDUHLDGfGp5nPxlX2stQLD+/zfvM9zzfzzvtRFEVBp9MRqPxfoGoP6PW9Wv+XmEwmMDQNlwqGVvhMr3a5huB2uxW4QCvPGIaBx+OB1WrtG1MqMRgMqFQqUEOWZew3ut1un9vtdu2NKZyyWMii2GqhtfEG3+8uoXr7FpoFHpIikiWJHKSi0+kgm+HApV+RWhRFog0GgwOGExNk8dt6BOkTZpQunkPMMIq0o3dQvV5HrVYj/GvtI86Mn8Sls5PIpaJ4l4rjw+c6PDc8ew23E+t4enAEzw6PYuXQCF6fd5L1UqkEPpeFpPBG4R5mLxwFfXoM0dlp3H/4HA+e8Lh89fquodrUXgMl7KQSyNPXkLkZQPOLAFH5rE9bWygW8qgIdWxzi7gzcwzT42PIJMJoizJ+tn5jfp7dNbTZbGi323gZT2CDzyOT47Eai+NFOIpyuYxGo4FqtYrmjxYW2SuwHj8Cy+QUVuPJ/k8Z6qFmmEwm8Xh5GWvRNUTCEYQehfCW44hAkiSSN4tZxFZCeL9ZVDS/iE6NhYUBQ6PRCEEQ9ozCfsZG2+90OnuG2g0xm83w+Xzw+/0IBAIEGlezBq/XC+/cHHxKVvezLAuHwzE82P979QbM8AfrI2YBV4drmwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/de8da5330cab014759be5fab0cddca89/984ea/2.png","srcSet":"/static/de8da5330cab014759be5fab0cddca89/984ea/2.png 1284w","sizes":"1284px"},"sources":[{"srcSet":"/static/de8da5330cab014759be5fab0cddca89/fb2c5/2.webp 1284w","type":"image/webp","sizes":"1284px"}]},"width":1284,"height":802}}},"date":"2024-12-02","category":"nestJS"}}},"pageContext":{"slug":"/blog/online-state/"}},"staticQueryHashes":["1840460387"],"slicesMap":{}}